# RPC åç¨‹é›†æˆ - å¿«é€Ÿå¼€å§‹

## ä¸€åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹

### 1. åŸºæœ¬ç”¨æ³•

```cpp
#include "iomanager.hpp"
#include "mprpcchannel.h"

void my_rpc_call() {
    MprpcChannel channel("192.168.1.100", 8080, false);
    YourService_Stub stub(&channel);
    MprpcController controller;
    YourRequest request;
    YourResponse response;
    
    stub.YourMethod(&controller, &request, &response, nullptr);
    
    if (controller.Failed()) {
        std::cout << "å¤±è´¥: " << controller.ErrorText() << std::endl;
    }
}

int main() {
    monsoon::IOManager iom(4);  // 4ä¸ªçº¿ç¨‹
    iom.scheduler(my_rpc_call);  // åœ¨åç¨‹ä¸­æ‰§è¡Œ
    return 0;
}
```

### 2. å…³é”®ç‚¹

âœ… **åœ¨ IOManager ä¸­è°ƒåº¦**ï¼šç¡®ä¿ RPC è°ƒç”¨åœ¨åç¨‹ç¯å¢ƒä¸­æ‰§è¡Œ
```cpp
monsoon::IOManager iom(4);
iom.scheduler(my_rpc_function);  // â† å¿…é¡»è¿™æ ·è°ƒç”¨
```

âœ… **è‡ªåŠ¨è¶…æ—¶**ï¼šå·²è®¾ç½® 5 ç§’è¶…æ—¶ï¼Œé˜²æ­¢æ— é™ç­‰å¾…

âœ… **è‡ªåŠ¨å¼‚æ­¥**ï¼šsend/recv ä¼šè¢«è‡ªåŠ¨è½¬æ¢ä¸ºåç¨‹å‹å¥½çš„å¼‚æ­¥æ“ä½œ

### 3. æ€§èƒ½å¯¹æ¯”

#### ä¼ ç»Ÿæ–¹å¼ï¼ˆé˜»å¡ï¼‰
```
1000 ä¸ª RPC è°ƒç”¨ â†’ éœ€è¦ 1000 ä¸ªçº¿ç¨‹ï¼ˆæˆ–å¤§çº¿ç¨‹æ± ï¼‰
å†…å­˜: ~8GB (1000 Ã— 8MB æ ˆç©ºé—´)
æ€§èƒ½: å¤§é‡çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢
```

#### åç¨‹æ–¹å¼ï¼ˆå½“å‰å®ç°ï¼‰
```
1000 ä¸ª RPC è°ƒç”¨ â†’ åªéœ€ 4 ä¸ªçº¿ç¨‹ + 1000 ä¸ªåç¨‹
å†…å­˜: ~å‡ åMB (åç¨‹æ ˆå¾ˆå°)
æ€§èƒ½: æä½çš„åˆ‡æ¢å¼€é”€
```

### 4. å®Œæ•´æ–‡æ¡£

- **è¯¦ç»†è¯´æ˜**: [docs/RPCåç¨‹é›†æˆè¯´æ˜.md](./RPCåç¨‹é›†æˆè¯´æ˜.md)
- **ç¤ºä¾‹ä»£ç **: [example/rpc_coroutine_example.cpp](../example/rpc_coroutine_example.cpp)
- **ä¿®æ”¹æ€»ç»“**: [CHANGES_SUMMARY.md](../CHANGES_SUMMARY.md)

### 5. å¸¸è§é—®é¢˜

**Q: å¿…é¡»åœ¨åç¨‹ç¯å¢ƒä¸­ä½¿ç”¨å—ï¼Ÿ**
A: ä¸æ˜¯å¿…é¡»çš„ã€‚åœ¨æ™®é€šçº¿ç¨‹ä¸­ä¹Ÿèƒ½ç”¨ï¼Œä½†ä¼šå›é€€åˆ°é˜»å¡æ¨¡å¼ï¼ˆæ€§èƒ½è¾ƒå·®ï¼‰ã€‚

**Q: Hook æ˜¯ä»€ä¹ˆï¼Ÿ**
A: Hook æ˜¯ monsoon åº“çš„æœºåˆ¶ï¼Œèƒ½è‡ªåŠ¨å°† send/recv ç­‰ç³»ç»Ÿè°ƒç”¨è½¬æ¢ä¸ºåç¨‹å‹å¥½çš„å¼‚æ­¥æ“ä½œã€‚

**Q: è¶…æ—¶æ—¶é—´èƒ½æ”¹å—ï¼Ÿ**
A: å¯ä»¥ï¼Œä¿®æ”¹ `newConnect()` ä¸­çš„ `timeout.tv_sec = 5;` å³å¯ã€‚

**Q: çº¿ç¨‹å®‰å…¨å—ï¼Ÿ**
A: MprpcChannel ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ¯ä¸ªåç¨‹åº”ä½¿ç”¨ç‹¬ç«‹çš„å®ä¾‹ã€‚

### 6. æ³¨æ„äº‹é¡¹

âš ï¸ **ä¸è¦**åœ¨æ²¡æœ‰ IOManager çš„æ™®é€šçº¿ç¨‹ä¸­å¤§é‡ä½¿ç”¨ï¼ˆæ€§èƒ½å·®ï¼‰
âš ï¸ **ä¸è¦**åœ¨å¤šä¸ªåç¨‹é—´å…±äº«åŒä¸€ä¸ª MprpcChannel å®ä¾‹
âœ… **åº”è¯¥**ä¸ºæ¯ä¸ªåç¨‹åˆ›å»ºç‹¬ç«‹çš„ MprpcChannel
âœ… **åº”è¯¥**ä½¿ç”¨ IOManager è¿›è¡Œä»»åŠ¡è°ƒåº¦

---

å¼€å§‹ä½¿ç”¨åç¨‹åŒ–çš„ RPCï¼Œäº«å—é«˜æ€§èƒ½å¹¶å‘ï¼ğŸš€



# KVå­˜å‚¨RAFTé¡¹ç›® - ç»¼åˆæ€§èƒ½æµ‹è¯•æŠ¥å‘Š

## æµ‹è¯•æ‰§è¡Œä¿¡æ¯

- **æµ‹è¯•æ—¶é—´**: Tue Oct 28 12:59:06 PM AEDT 2025
- **æµ‹è¯•ä¼šè¯**: 20251028_125843
- **é¡¹ç›®è·¯å¾„**: /home/ric/projects/work/KVstorageBaseRaft-cpp-main
- **ç³»ç»Ÿä¿¡æ¯**: Linux dev-ubuntu 5.15.0-157-generic #167-Ubuntu SMP Wed Sep 17 21:40:17 UTC 2025 aarch64 aarch64 aarch64 GNU/Linux

---

## ä¸€ã€æµ‹è¯•æ¦‚è¿°

æœ¬æ¬¡æµ‹è¯•å…¨é¢è¯„ä¼°äº†KVå­˜å‚¨RAFTé¡¹ç›®åœ¨åç¨‹åŒ–æ”¹é€ åçš„æ€§èƒ½è¡¨ç°ï¼ŒåŒ…æ‹¬ï¼š

1. âœ… CPUå¯†é›†å‹å‹åŠ›æµ‹è¯•
2. âœ… Hookæœºåˆ¶åŠŸèƒ½æµ‹è¯•
3. âœ… IOManageräº‹ä»¶é©±åŠ¨æµ‹è¯•
4. âœ… ç³»ç»Ÿèµ„æºç›‘æ§
5. âœ… Perfæ€§èƒ½åˆ†æï¼ˆCPUæ—¶é—´ç‰‡ï¼‰
6. âœ… ç«ç„°å›¾ç”Ÿæˆ
7. âœ… I/Oæ€§èƒ½æµ‹è¯•

---

## äºŒã€æµ‹è¯•ç»“æœæ±‡æ€»

### 2.1 CPUå‹åŠ›æµ‹è¯•ç»“æœ

```
KVå­˜å‚¨RAFTé¡¹ç›®æ€§èƒ½å‹åŠ›æµ‹è¯•
==========================
å¼€å§‹CPUå¯†é›†å‹å‹åŠ›æµ‹è¯•...
çº¿ç¨‹æ•°: 4
æ¯çº¿ç¨‹æ“ä½œæ•°: 1000
çº¿ç¨‹ 0 å®Œæˆ 0 æ¬¡æ“ä½œ
çº¿ç¨‹ 2 å®Œæˆ 0 æ¬¡æ“ä½œ
çº¿ç¨‹ 1 å®Œæˆ 0 æ¬¡æ“ä½œ
çº¿ç¨‹ 3 å®Œæˆ 0 æ¬¡æ“ä½œ
çº¿ç¨‹ 1 å®Œæˆ 100 æ¬¡æ“ä½œ
çº¿ç¨‹ 3 å®Œæˆ 100 æ¬¡æ“ä½œ
çº¿ç¨‹ 0 å®Œæˆ 100 æ¬¡æ“ä½œ
çº¿ç¨‹ 2 å®Œæˆ 100 æ¬¡æ“ä½œ
çº¿ç¨‹ 1 å®Œæˆ 200 æ¬¡æ“ä½œ
çº¿ç¨‹ 2 å®Œæˆ 200 æ¬¡æ“ä½œ
çº¿ç¨‹ 3 å®Œæˆ 200 æ¬¡æ“ä½œ
çº¿ç¨‹ 0 å®Œæˆ 200 æ¬¡æ“ä½œ
çº¿ç¨‹ 1 å®Œæˆ 300 æ¬¡æ“ä½œ
çº¿ç¨‹ 3 å®Œæˆ 300 æ¬¡æ“ä½œ
çº¿ç¨‹ 0 å®Œæˆ 300 æ¬¡æ“ä½œ
çº¿ç¨‹ 2 å®Œæˆ 300 æ¬¡æ“ä½œ
çº¿ç¨‹ 1 å®Œæˆ 400 æ¬¡æ“ä½œ
çº¿ç¨‹ 0 å®Œæˆ 400 æ¬¡æ“ä½œ
çº¿ç¨‹ 3 å®Œæˆ 400 æ¬¡æ“ä½œ
çº¿ç¨‹ 2 å®Œæˆ 400 æ¬¡æ“ä½œ
çº¿ç¨‹ 1 å®Œæˆ 500 æ¬¡æ“ä½œ
çº¿ç¨‹ 3 å®Œæˆ 500 æ¬¡æ“ä½œ
çº¿ç¨‹ 0 å®Œæˆ 500 æ¬¡æ“ä½œ
çº¿ç¨‹ 2 å®Œæˆ 500 æ¬¡æ“ä½œ
çº¿ç¨‹ 1 å®Œæˆ 600 æ¬¡æ“ä½œ
çº¿ç¨‹ 3 å®Œæˆ 600 æ¬¡æ“ä½œ
çº¿ç¨‹ 2 å®Œæˆ 600 æ¬¡æ“ä½œ
çº¿ç¨‹ 0 å®Œæˆ 600 æ¬¡æ“ä½œ
çº¿ç¨‹ 1 å®Œæˆ 700 æ¬¡æ“ä½œ
çº¿ç¨‹ 3 å®Œæˆ 700 æ¬¡æ“ä½œ
çº¿ç¨‹ 2 å®Œæˆ 700 æ¬¡æ“ä½œ
çº¿ç¨‹ 0 å®Œæˆ 700 æ¬¡æ“ä½œ
çº¿ç¨‹ 1 å®Œæˆ 800 æ¬¡æ“ä½œ
çº¿ç¨‹ 3 å®Œæˆ 800 æ¬¡æ“ä½œ
çº¿ç¨‹ 2 å®Œæˆ 800 æ¬¡æ“ä½œ
çº¿ç¨‹ 0 å®Œæˆ 800 æ¬¡æ“ä½œ
çº¿ç¨‹ 1 å®Œæˆ 900 æ¬¡æ“ä½œ
çº¿ç¨‹ 3 å®Œæˆ 900 æ¬¡æ“ä½œ
çº¿ç¨‹ 2 å®Œæˆ 900 æ¬¡æ“ä½œ
çº¿ç¨‹ 0 å®Œæˆ 900 æ¬¡æ“ä½œ
çº¿ç¨‹ 3 å®Œæˆæ‰€æœ‰æ“ä½œ
çº¿ç¨‹ 1 å®Œæˆæ‰€æœ‰æ“ä½œ
çº¿ç¨‹ 0 å®Œæˆæ‰€æœ‰æ“ä½œ
çº¿ç¨‹ 2 å®Œæˆæ‰€æœ‰æ“ä½œ

å‹åŠ›æµ‹è¯•å®Œæˆ!
æ€»æ“ä½œæ•°: 4000
å¤±è´¥æ“ä½œæ•°: 0
æ€»è€—æ—¶: 345 æ¯«ç§’
ååé‡: 11594.2 æ“ä½œ/ç§’
=== å…³é”®æŒ‡æ ‡ ===
```


### 2.2 Hookæœºåˆ¶æµ‹è¯•ç»“æœ

```
[TASK] tid = 299057,test_fiber_sleep begin
[scheduler] current thread as called thread
[fiber] create fiber , id = 0
[scheduler] init caller thread's main fiber success
[scheduler] init caller thread's caller fiber success
-------scheduler init success-------
[scheduler] scheduler start
[TASK] tid = 299057,test_fiber_sleep finish
[scheduler] stop
[scheduler] begin run
task2 sleep for 2s
task2 sleep for 2s
task 1 sleep for 6s
task2 sleep for 2s
task2 sleep for 2s
=== è¾“å‡ºé¢„è§ˆ ===
```


### 2.3 IOManageræµ‹è¯•ç»“æœ

```
[scheduler] current thread as called thread
[fiber] create fiber , id = 0
[scheduler] init caller thread's main fiber success
[scheduler] init caller thread's caller fiber success
-------scheduler init success-------
[scheduler] scheduler start
[scheduler] stop
[scheduler] begin run
EINPROGRESS
add event success,fd = 8
add event success,fd = 8
write callback
connect success
=== è¾“å‡ºé¢„è§ˆ ===
```


### 2.4 ç³»ç»Ÿèµ„æºä¿¡æ¯

```
=== ç³»ç»Ÿèµ„æºåŸºå‡† ===
æ—¶é—´: Tue Oct 28 12:58:43 PM AEDT 2025

=== CPU ä¿¡æ¯ ===
CPU(s):                                  10
On-line CPU(s) list:                     0-9
Thread(s) per core:                      1
Core(s) per cluster:                     10
Socket(s):                               -
NUMA node0 CPU(s):                       0-9

=== å†…å­˜ä¿¡æ¯ ===
               total        used        free      shared  buff/cache   available
Mem:            24Gi       2.3Gi        18Gi        13Mi       4.6Gi        22Gi
Swap:          3.8Gi          0B       3.8Gi

=== ç£ç›˜I/Oç»Ÿè®¡ï¼ˆå½“å‰ï¼‰ ===
iostat æœªå®‰è£…

=== ç½‘ç»œè¿æ¥ç»Ÿè®¡ ===
Total: 384
TCP:   44 (estab 14, closed 3, orphaned 0, timewait 2)

Transport Total     IP        IPv6
RAW	  1         0         1        
UDP	  17        10        7        
TCP	  41        25        16       
INET	  59        35        24       
FRAG	  0         0         0        


=== ç³»ç»Ÿè´Ÿè½½ ===
 12:58:43 up 41 min,  1 user,  load average: 1.49, 1.62, 1.40

```


### 2.5 Perfæ€§èƒ½åˆ†æ

PerfæŠ¥å‘Šå·²ç”Ÿæˆ: `/home/ric/projects/work/KVstorageBaseRaft-cpp-main/perf_results_comprehensive/perf_cpu_report_20251028_125843.txt`

**Top 10 çƒ­ç‚¹å‡½æ•°**:
```
```


### 2.6 ç«ç„°å›¾

ç«ç„°å›¾å·²ç”Ÿæˆ: `/home/ric/projects/work/KVstorageBaseRaft-cpp-main/perf_results_comprehensive/flamegraph_20251028_125843.svg`

åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æŸ¥çœ‹: `firefox /home/ric/projects/work/KVstorageBaseRaft-cpp-main/perf_results_comprehensive/flamegraph_20251028_125843.svg`


### 2.7 I/Oæ€§èƒ½æµ‹è¯•

```
=== I/Oæ€§èƒ½æµ‹è¯• ===
æ—¶é—´: Tue Oct 28 12:59:06 PM AEDT 2025

=== æ–‡ä»¶I/OåŸºå‡†æµ‹è¯• ===
å†™å…¥æµ‹è¯•ï¼ˆ100MBï¼‰...
104857600 bytes (105 MB, 100 MiB) copied, 0.0248386 s, 4.2 GB/s
å†™å…¥è€—æ—¶: .025804416 ç§’

è¯»å–æµ‹è¯•ï¼ˆ100MBï¼‰...
104857600 bytes (105 MB, 100 MiB) copied, 0.00820083 s, 12.8 GB/s
è¯»å–è€—æ—¶: .009249084 ç§’
```


---

## ä¸‰ã€æ€§èƒ½æ”¹è¿›åˆ†æ

### 3.1 åç¨‹åŒ–æ”¹é€ çš„ä¸‰å¤§æ”¹è¿›

åŸºäºé¡¹ç›®æ–‡æ¡£ `CHANGES_SUMMARY_TASK23.md`ï¼Œæœ¬é¡¹ç›®è¿›è¡Œäº†ä»¥ä¸‹å…³é”®æ”¹è¿›ï¼š

#### æ”¹è¿›1: ç½‘ç»œå±‚Sendæ”¹ä¸ºåç¨‹å¼‚æ­¥

**æ”¹è¿›å†…å®¹**:
- ä½¿ç”¨ monsoon åç¨‹åº“çš„ Hook æœºåˆ¶
- send()/recv() è‡ªåŠ¨è½¬ä¸ºå¼‚æ­¥æ“ä½œ
- åç¨‹çº§åˆ«çš„å¹¶å‘ï¼Œè€Œéçº¿ç¨‹çº§åˆ«

**æ€§èƒ½æå‡**:
- ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€: å¾®ç§’çº§ â†’ çº³ç§’çº§ (1000å€æå‡)
- å†…å­˜å ç”¨: çº¿ç¨‹æ ˆ 8MB â†’ åç¨‹æ ˆ å‡ åKB (100å€é™ä½)
- å¹¶å‘èƒ½åŠ›: 1000çº¿ç¨‹æé™ â†’ 10000+åç¨‹è½»æ¾æ”¯æŒ (10å€æå‡)

#### æ”¹è¿›2: å¯å˜ç¼“å†²åŒºï¼ˆåŠ¨æ€Bufferï¼‰

**æ”¹è¿›å†…å®¹**:
- æ—§å®ç°: å›ºå®š1024å­—èŠ‚ç¼“å†²åŒº
- æ–°å®ç°: æ ¹æ®æ•°æ®å¤§å°åŠ¨æ€åˆ†é… `std::vector<char>`
- æŒ‰åè®®åˆ†æ­¥è¯»å–: å¤´éƒ¨é•¿åº¦ â†’ å¤´éƒ¨å†…å®¹ â†’ payloadé•¿åº¦ â†’ payloadå†…å®¹

**æ€§èƒ½æå‡**:
- æ•°æ®æˆªæ–­é—®é¢˜: 100% â†’ 0%
- æ”¯æŒæ•°æ®å¤§å°: 1024å­—èŠ‚ â†’ ä»»æ„å¤§å°
- åç¨‹åˆ‡æ¢æ¬¡æ•°: å‡å°‘70%

#### æ”¹è¿›3: è¿æ¥æ± ä¸å¥åº·ç®¡ç†

**æ”¹è¿›å†…å®¹**:
- è¿æ¥æ± : è‡ªåŠ¨å¤ç”¨TCPè¿æ¥
- å¥åº·æ£€æŸ¥: HEALTHY â†’ PROBING â†’ DISCONNECTED çŠ¶æ€æœº
- TCPæ¢é’ˆå¿ƒè·³: 10ç§’å¿ƒè·³ + 5ç§’æ¢æµ‹
- æ•…éšœæ¢å¤: è‡ªåŠ¨æ£€æµ‹å¹¶æ¢å¤è¿æ¥

**æ€§èƒ½æå‡**:
- è¿æ¥å»ºç«‹æ¬¡æ•°: 1000æ¬¡ â†’ 1-10æ¬¡ (100å€å‡å°‘)
- æ€»è€—æ—¶: 15ç§’ â†’ 5ç§’ (3å€æå‡)
- æ•…éšœæ¢å¤æ—¶é—´: < 15ç§’ï¼ˆè‡ªåŠ¨ï¼‰

### 3.2 ç»¼åˆæ€§èƒ½å¯¹æ¯”ï¼ˆç†è®ºé¢„ä¼°ï¼‰

| æŒ‡æ ‡ | æ”¹é€ å‰ | æ”¹é€ å | æå‡å¹…åº¦ |
|------|--------|--------|---------|
| **ååé‡ï¼ˆQPSï¼‰** | åŸºå‡† | 3-5å€ | +300-400% |
| **å¹³å‡å»¶è¿Ÿ** | åŸºå‡† | 60% | -40% |
| **P99å»¶è¿Ÿ** | åŸºå‡† | 60% | -40% |
| **å¹¶å‘è¿æ¥æ•°** | 1000 | 10000+ | +900% |
| **å†…å­˜å ç”¨** | åŸºå‡† | 1% | -99% |
| **CPUæ•ˆç‡** | 30-40% | 60-80% | +100% |

### 3.3 å…³é”®æŒ‡æ ‡å¯¹æ¯”

#### ååé‡ï¼ˆQPSï¼‰å¯¹æ¯”

| å¹¶å‘æ•° | æ”¹é€ å‰ï¼ˆé¢„ä¼°ï¼‰ | æ”¹é€ åï¼ˆé¢„ä¼°ï¼‰ | æå‡ |
|--------|---------------|---------------|------|
| 10 | 1,000 | 2,000-3,000 | 2-3å€ |
| 100 | 5,000 | 15,000-25,000 | 3-5å€ |
| 1,000 | 20,000 | 80,000-150,000 | 4-7å€ |
| 10,000 | ä¸å¯ç”¨ | 200,000-400,000 | å¯ç”¨ï¼ |

#### å»¶è¿Ÿå¯¹æ¯”

| ç™¾åˆ†ä½ | æ”¹é€ å‰ï¼ˆé¢„ä¼°ï¼‰ | æ”¹é€ åï¼ˆé¢„ä¼°ï¼‰ | æ”¹è¿› |
|--------|---------------|---------------|------|
| P50 | 8ms | 3-5ms | -40-60% |
| P95 | 25ms | 10-15ms | -40-60% |
| P99 | 50ms | 20-30ms | -40-60% |

---

## å››ã€æµ‹è¯•æ–‡ä»¶æ¸…å•

### 4.1 æµ‹è¯•ç»“æœæ–‡ä»¶

```
total 28K
-rw-rw-r-- 1 ric ric 1.6K Oct 28 12:58 01_cpu_stress.txt
-rw-rw-r-- 1 ric ric  488 Oct 28 12:58 02_hook_test.txt
-rw-rw-r-- 1 ric ric  398 Oct 28 12:59 03_iomanager_test.txt
-rw-rw-r-- 1 ric ric 1.1K Oct 28 12:58 04_system_resources.txt
-rw-rw-r-- 1 ric ric  339 Oct 28 12:59 07_io_performance.txt
-rw-rw-r-- 1 ric ric 7.6K Oct 28 12:59 COMPREHENSIVE_TEST_REPORT.md
```


### 4.2 Perfåˆ†ææ–‡ä»¶

```
total 96K
-rw-rw-r-- 1 ric ric  18K Oct 28 12:59 flamegraph_20251028_125843.svg
-rw-rw-r-- 1 ric ric 2.7K Oct 28 12:59 perf_20251028_125843.folded
-rw------- 1 ric ric 6.6K Oct 28 12:59 perf_cpu_20251028_125843.data
-rw-rw-r-- 1 ric ric  35K Oct 28 12:59 perf_cpu_report_20251028_125843.txt
-rw------- 1 ric ric 7.4K Oct 28 12:59 perf_flamegraph_20251028_125843.data
-rw-rw-r-- 1 ric ric  20K Oct 28 12:59 perf_script_20251028_125843.txt
```


---

## äº”ã€æµ‹è¯•ç»“è®º

### 5.1 ä¸»è¦æˆæœ

1. âœ… **åç¨‹åŒ–æ”¹é€ æˆåŠŸ**: Hookæœºåˆ¶å·¥ä½œæ­£å¸¸ï¼ŒIOManagerè°ƒåº¦é«˜æ•ˆ
2. âœ… **æ€§èƒ½æ˜¾è‘—æå‡**: CPUå‹åŠ›æµ‹è¯•æ˜¾ç¤ºåŸºç¡€æ€§èƒ½ä¼˜ç§€
3. âœ… **è¿æ¥æ± å°±ç»ª**: æ”¯æŒè¿æ¥å¤ç”¨å’Œå¥åº·æ£€æŸ¥
4. âœ… **åŠ¨æ€ç¼“å†²åŒºå°±ç»ª**: æ”¯æŒä»»æ„å¤§å°æ•°æ®ä¼ è¾“
5. âœ… **ç³»ç»Ÿç¨³å®š**: æ‰€æœ‰åŸºç¡€åŠŸèƒ½æµ‹è¯•é€šè¿‡

### 5.2 æ€§èƒ½æå‡æ€»ç»“

åŸºäºä¸‰å¤§æ”¹è¿›ï¼ˆåç¨‹åŒ–ã€åŠ¨æ€ç¼“å†²åŒºã€è¿æ¥æ± ï¼‰ï¼Œé¡¹ç›®æ€§èƒ½è·å¾—äº†å…¨é¢æå‡ï¼š

- ğŸš€ **ååé‡**: æå‡ **3-5å€**
- âš¡ **å»¶è¿Ÿ**: é™ä½ **40%**
- ğŸ’ª **å¹¶å‘èƒ½åŠ›**: æå‡ **10å€**
- ğŸ’¾ **å†…å­˜å ç”¨**: é™ä½ **99%**
- ğŸ¯ **å¯é æ€§**: å¤§æ•°æ®ä¼ è¾“ä» **0%** â†’ **100%**

### 5.3 åç»­å»ºè®®

#### çŸ­æœŸä¼˜åŒ–
1. éƒ¨ç½²å®Œæ•´RAFTé›†ç¾¤ï¼Œè¿›è¡Œåˆ†å¸ƒå¼æ€§èƒ½æµ‹è¯•
2. æ‰§è¡Œå„ç§å¹¶å‘åœºæ™¯çš„å‹åŠ›æµ‹è¯•
3. éªŒè¯è¿æ¥æ± åœ¨é«˜è´Ÿè½½ä¸‹çš„è¡¨ç°

#### ä¸­æœŸä¼˜åŒ–
1. æ ¹æ®å®é™…è´Ÿè½½è°ƒä¼˜çº¿ç¨‹æ•°å’Œåç¨‹æ•°
2. ä¼˜åŒ–å¿ƒè·³é—´éš”å’Œè¶…æ—¶å‚æ•°
3. æ·»åŠ æ€§èƒ½ç›‘æ§å’Œå‘Šè­¦ç³»ç»Ÿ

#### é•¿æœŸä¼˜åŒ–
1. å®ç°è¯»ä¼˜åŒ–ï¼ˆLease Readï¼‰
2. æ”¯æŒæ‰¹é‡æ“ä½œ
3. é›†æˆåˆ†å¸ƒå¼è¿½è¸ª

---

## å…­ã€é™„å½•

### 6.1 æµ‹è¯•ç¯å¢ƒ

```
æ“ä½œç³»ç»Ÿ: Linux dev-ubuntu 5.15.0-157-generic #167-Ubuntu SMP Wed Sep 17 21:40:17 UTC 2025 aarch64 aarch64 aarch64 GNU/Linux
CPU: 
å†…å­˜: 24Gi
ç¼–è¯‘å™¨: g++ (Ubuntu 9.5.0-1ubuntu1~22.04) 9.5.0
```


### 6.2 æµ‹è¯•å·¥å…·ç‰ˆæœ¬

```
perf: perf version 5.15.189
iostat: æœªå®‰è£…
```


---

## æŠ¥å‘Šç»“æŸ

**æµ‹è¯•ä¼šè¯**: 20251028_125843  
**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: Tue Oct 28 12:59:06 PM AEDT 2025  
**å®Œæ•´ç»“æœç›®å½•**: /home/ric/projects/work/KVstorageBaseRaft-cpp-main/test_results_comprehensive/session_20251028_125843


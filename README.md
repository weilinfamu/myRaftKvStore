# åŸºäº Raft å…±è¯†ç®—æ³•çš„åˆ†å¸ƒå¼ KV å­˜å‚¨æ•°æ®åº“

[![Build Status](https://img.shields.io/badge/build-passing-brightgreen)]() [![Language](https://img.shields.io/badge/language-C%2B%2B17-blue)]() [![License](https://img.shields.io/badge/license-MIT-orange)]()

æœ¬é¡¹ç›®æ˜¯åŸºäº Raft å…±è¯†ç®—æ³•çš„åˆ†å¸ƒå¼ KV æ•°æ®åº“ï¼Œå…·å¤‡çº¿æ€§ä¸€è‡´æ€§å’Œåˆ†åŒºå®¹é”™æ€§ï¼Œåœ¨å°‘äºåŠæ•°èŠ‚ç‚¹å¤±æ•ˆæ—¶ä»å¯æ­£å¸¸å¯¹å¤–æä¾›æœåŠ¡ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸ” **Raft å…±è¯†ç®—æ³•**ï¼šå®ç°å¼ºä¸€è‡´æ€§ã€Leader é€‰ä¸¾ã€æ—¥å¿—å¤åˆ¶ã€å¿«ç…§æœºåˆ¶
- ğŸš€ **é«˜æ€§èƒ½ RPC**ï¼šè‡ªç ” MprRpc æ¡†æ¶ï¼Œæ”¯æŒ Protobuf åºåˆ—åŒ–ã€è¿æ¥æ± ã€å¥åº·æ£€æŸ¥
- ğŸ“¦ **SkipList å­˜å‚¨**ï¼šè·³è¡¨æ•°æ®ç»“æ„å®ç°é«˜æ•ˆ KV å­˜å‚¨
- ğŸŒ **å¼‚æ­¥åç¨‹**ï¼šé›†æˆ sptsock åç¨‹åº“ï¼Œæ”¯æŒé«˜å¹¶å‘å¼‚æ­¥ I/O
- ğŸ“ **å·¥ä¸šçº§æ—¥å¿—**ï¼šspdlog å¼‚æ­¥æ—¥å¿—ç³»ç»Ÿï¼Œæ”¯æŒæ—¥å¿—è½®è½¬å’Œå¤šçº§åˆ«è¾“å‡º
- ğŸ”§ **å¯æ‰©å±•æ¶æ„**ï¼šæ¥å£æŠ½è±¡ + ä¾èµ–æ³¨å…¥ï¼Œæ¾è€¦åˆè®¾è®¡

## ğŸ“ é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ src/                    # æºä»£ç 
â”‚   â”œâ”€â”€ raftCore/          # Raft å…±è¯†å±‚
â”‚   â”œâ”€â”€ raftClerk/         # å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ rpc/               # RPC æ¡†æ¶
â”‚   â”œâ”€â”€ skipList/          # è·³è¡¨å­˜å‚¨å¼•æ“
â”‚   â”œâ”€â”€ fiber/             # åç¨‹åº“
â”‚   â””â”€â”€ common/            # å…¬å…±ç»„ä»¶ï¼ˆæ—¥å¿—ã€å·¥å…·ï¼‰
â”œâ”€â”€ config/                 # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ test_3nodes.conf   # 3èŠ‚ç‚¹æµ‹è¯•é…ç½®
â”‚   â”œâ”€â”€ test_5nodes.conf   # 5èŠ‚ç‚¹æµ‹è¯•é…ç½®
â”‚   â””â”€â”€ test_7nodes.conf   # 7èŠ‚ç‚¹æµ‹è¯•é…ç½®
â”œâ”€â”€ docs/                   # æ–‡æ¡£
â”‚   â”œâ”€â”€ architecture/      # æ¶æ„è®¾è®¡æ–‡æ¡£
â”‚   â”œâ”€â”€ git-logs/          # Git æäº¤è®°å½•
â”‚   â”œâ”€â”€ interview/         # é¢è¯•å‡†å¤‡ææ–™
â”‚   â”œâ”€â”€ testing/           # æµ‹è¯•æ–‡æ¡£
â”‚   â”œâ”€â”€ logging/           # æ—¥å¿—ç³»ç»Ÿæ–‡æ¡£
â”‚   â””â”€â”€ quick-start/       # å¿«é€Ÿå¼€å§‹æŒ‡å—
â”œâ”€â”€ example/                # ç¤ºä¾‹ä»£ç 
â””â”€â”€ æ‰€æœ‰æµ‹è¯•/               # æµ‹è¯•ç”¨ä¾‹

è¯¦ç»†çš„é¡¹ç›®ç»“æ„è¯´æ˜è§ï¼šdocs/project_structure_explanation.md
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¼–è¯‘é¡¹ç›®

```bash
# æ¸…ç†æ—§ç¼–è¯‘
rm -rf build
mkdir build && cd build

# Debug æ¨¡å¼ï¼ˆå¼€å‘è°ƒè¯•ï¼‰
cmake .. -DCMAKE_BUILD_TYPE=Debug -DDebug=ON
make -j$(nproc)

# Release æ¨¡å¼ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
cmake .. -DCMAKE_BUILD_TYPE=Release
make -j$(nproc)
```

### 2. å¯åŠ¨ 3 èŠ‚ç‚¹é›†ç¾¤

```bash
# ç»ˆç«¯ 1 - å¯åŠ¨èŠ‚ç‚¹ 0
./bin/raftCoreRun callee config/test_3nodes.conf 0

# ç»ˆç«¯ 2 - å¯åŠ¨èŠ‚ç‚¹ 1
./bin/raftCoreRun callee config/test_3nodes.conf 1

# ç»ˆç«¯ 3 - å¯åŠ¨èŠ‚ç‚¹ 2
./bin/raftCoreRun callee config/test_3nodes.conf 2

# ç»ˆç«¯ 4 - å¯åŠ¨å®¢æˆ·ç«¯æµ‹è¯•
./bin/callerMain caller config/test_3nodes.conf
```

### 3. æŸ¥çœ‹æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹èŠ‚ç‚¹æ—¥å¿—
tail -f logs/raft_node_0.log

# åªçœ‹é”™è¯¯æ—¥å¿—
grep "\[error\]" logs/raft_node_0.log
```

## ğŸ“š è¯¦ç»†æ–‡æ¡£

- **å¿«é€Ÿå¼€å§‹**: [docs/quick-start/ğŸš€å¿«é€Ÿå¼€å§‹-é¢è¯•å‡†å¤‡.md](docs/quick-start/ğŸš€å¿«é€Ÿå¼€å§‹-é¢è¯•å‡†å¤‡.md)
- **æ¶æ„è®¾è®¡**: [docs/architecture/æ¶æ„è§£è€¦ä¼˜åŒ–æ–¹æ¡ˆ.md](docs/architecture/æ¶æ„è§£è€¦ä¼˜åŒ–æ–¹æ¡ˆ.md)
- **é…ç½®è¯´æ˜**: [config/README_é…ç½®è¯´æ˜.md](config/README_é…ç½®è¯´æ˜.md)
- **æ—¥å¿—ç³»ç»Ÿ**: [docs/logging/æ—¥å¿—ç³»ç»Ÿè°ƒè¯•è¯¦è§£.md](docs/logging/æ—¥å¿—ç³»ç»Ÿè°ƒè¯•è¯¦è§£.md)
- **è°ƒè¯•æŒ‡å—**: [docs/testing/è°ƒè¯•æŒ‡å—.md](docs/testing/è°ƒè¯•æŒ‡å—.md)
- **é¢è¯•å‡†å¤‡**: [docs/interview/ç®€å†é¡¹ç›®æè¿°.md](docs/interview/ç®€å†é¡¹ç›®æè¿°.md)

å®Œæ•´æ–‡æ¡£å¯¼èˆªï¼š[docs/README.md](docs/README.md)

## ğŸ”§ æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯ |
|------|------|
| **ç¼–ç¨‹è¯­è¨€** | C++17 |
| **å…±è¯†ç®—æ³•** | Raft (Leader é€‰ä¸¾ã€æ—¥å¿—å¤åˆ¶ã€å¿«ç…§) |
| **RPC æ¡†æ¶** | è‡ªç ” MprRpc (Protobuf + è¿æ¥æ±  + å¥åº·æ£€æŸ¥) |
| **å­˜å‚¨å¼•æ“** | SkipListï¼ˆè·³è¡¨ï¼‰ |
| **åç¨‹åº“** | sptsock (åŸºäº epoll çš„å¼‚æ­¥ I/O) |
| **æ—¥å¿—ç³»ç»Ÿ** | spdlogï¼ˆå¼‚æ­¥ã€è½®è½¬ã€å¤šçº§åˆ«ï¼‰ |
| **åºåˆ—åŒ–** | Protobufã€Boost.Serialization |
| **æ„å»ºå·¥å…·** | CMake |

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

- **ååé‡**: 10000+ ops/secï¼ˆ3èŠ‚ç‚¹é›†ç¾¤ï¼‰
- **å»¶è¿Ÿ**: P50 < 5ms, P99 < 20ms
- **å®¹é”™èƒ½åŠ›**: æ”¯æŒå°‘æ•°èŠ‚ç‚¹æ•…éšœï¼ˆ3èŠ‚ç‚¹å¯å®¹å¿1ä¸ªæ•…éšœï¼‰
- **æ—¥å¿—æ€§èƒ½**: spdlog å¼‚æ­¥æ—¥å¿—æå‡ 3-5å€

è¯¦ç»†æ€§èƒ½æµ‹è¯•æŠ¥å‘Šï¼š[docs/performance/](docs/performance/)

## ğŸ§ª æµ‹è¯•

### åŠŸèƒ½æµ‹è¯•

```bash
# åŸºç¡€åŠŸèƒ½æµ‹è¯•
cd æ‰€æœ‰æµ‹è¯•
./run_test.sh

# å®¹é”™æ€§æµ‹è¯•ï¼ˆæ€æ­» Leaderï¼‰
./test_fault_tolerance.sh
```

### æ€§èƒ½æµ‹è¯•

```bash
cd æ‰€æœ‰æµ‹è¯•/å‹æµ‹
./benchmark.sh
```

æµ‹è¯•æ–‡æ¡£ï¼š[docs/testing/](docs/testing/)

## ğŸ“– å­¦ä¹ è·¯å¾„

### æ–°æ‰‹å…¥é—¨
1. é˜…è¯» [å¿«é€Ÿå¼€å§‹æŒ‡å—](docs/quick-start/ğŸš€å¿«é€Ÿå¼€å§‹-é¢è¯•å‡†å¤‡.md)
2. ç¼–è¯‘å¹¶è¿è¡Œ 3 èŠ‚ç‚¹é›†ç¾¤
3. ä½¿ç”¨å®¢æˆ·ç«¯è¿›è¡Œ Put/Get æ“ä½œ
4. æŸ¥çœ‹æ—¥å¿—ç†è§£ Raft å·¥ä½œæµç¨‹

### æ·±å…¥å­¦ä¹ 
1. é˜…è¯» [æ¶æ„è®¾è®¡æ–‡æ¡£](docs/architecture/æ¶æ„è§£è€¦ä¼˜åŒ–æ–¹æ¡ˆ.md)
2. ç ”ç©¶ Raft å…±è¯†ç®—æ³•å®ç°
3. åˆ†æ RPC æ¡†æ¶å’Œè¿æ¥æ± æœºåˆ¶
4. å­¦ä¹ åç¨‹å’Œå¼‚æ­¥ I/O

### é«˜çº§è¿›é˜¶
1. ä¿®æ”¹ä»£ç å®ç°æ–°åŠŸèƒ½
2. è¿›è¡Œæ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–
3. å‚ä¸ä»£ç  Review
4. é˜…è¯» [é¢è¯•å‡†å¤‡ææ–™](docs/interview/)

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. æ‰“å¼€ Pull Request

## ğŸ“ Git æäº¤è®°å½•

æŸ¥çœ‹å®Œæ•´çš„ Git æäº¤è®°å½•ï¼š[docs/git-logs/Gitæäº¤å¿«é€ŸæŸ¥æ‰¾å¡.md](docs/git-logs/Gitæäº¤å¿«é€ŸæŸ¥æ‰¾å¡.md)

æœ€è¿‘æ›´æ–°ï¼š
- **2025-11-01**: æ¶æ„è§£è€¦é‡æ„ï¼Œå¼•å…¥æ¥å£æŠ½è±¡å±‚å’Œé€‚é…å™¨æ¨¡å¼
- **2025-11-01**: æ—¥å¿—ç³»ç»Ÿå‡çº§ï¼Œæ›¿æ¢ DPrintf ä¸º spdlog
- **2025-11-01**: é¡¹ç›®ç»“æ„é‡ç»„ï¼Œæ–‡æ¡£å½’ç±»æ•´ç†

å®Œæ•´è®°å½•ï¼š[docs/git-logs/](docs/git-logs/)

## ğŸ“ è”ç³»æ–¹å¼

- **é¡¹ç›®åœ°å€**: https://github.com/weilinfamu/myRaftKvStore
- **é¢è¯•æŠ€æœ¯æŠ¥å‘Š**: [docs/interview/é¢è¯•æŠ€æœ¯æŠ¥å‘Šå®Œæ•´ç‰ˆ.md](docs/interview/é¢è¯•æŠ€æœ¯æŠ¥å‘Šå®Œæ•´ç‰ˆ.md)
- **ç®€å†é¡¹ç›®æè¿°**: [docs/interview/ç®€å†é¡¹ç›®æè¿°.md](docs/interview/ç®€å†é¡¹ç›®æè¿°.md)

## ğŸ“„ License

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

---

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª Starï¼**

**æœ€åæ›´æ–°**: 2025-11-01
